# Guia de Testing - Endpoints de productos

Esta guia describe escenarios de prueba para los endpoints de gestion de productos.

## Herramientas recomendadas

Para realizar testing manual puedes usar:

- Postman
- cURL (terminal)
- Thunder Client (extension de VS Code)
- Insomnia

---

## 1. Testing de PUT /products/:id

### Escenario 1: actualizar solo el nombre

**Peticion**

```bash
curl -X PUT http://localhost:3000/api/products/1 \
  -H "Authorization: Bearer TU_TOKEN_JWT" \
  -H "Content-Type: application/json" \
  -d '{"name": "Mouse Logitech G305 Inalambrico"}'
```

**Respuesta esperada (200 OK)**

```json
{
  "id": 1,
  "name": "Mouse Logitech G305 Inalambrico",
  "price_cents": 19990,
  "stock": 25,
  "is_active": true,
  "createdAt": "2025-10-22T20:00:00.000Z",
  "updatedAt": "2025-10-22T23:28:07.000Z"
}
```

### Escenario 2: actualizar multiples campos

**Peticion**

```bash
curl -X PUT http://localhost:3000/api/products/2 \
  -H "Authorization: Bearer TU_TOKEN_JWT" \
  -H "Content-Type: application/json" \
  -d '{"price_cents": 27990, "stock": 20, "is_active": true}'
```

**Respuesta esperada (200 OK)**  
Producto con los campos actualizados.

### Escenario 3: datos invalidos

**Peticion**

```bash
curl -X PUT http://localhost:3000/api/products/3 \
  -H "Authorization: Bearer TU_TOKEN_JWT" \
  -H "Content-Type: application/json" \
  -d '{"price_cents": -100}'
```

**Respuesta esperada (400 Bad Request)**

```json
{
  "error": "Datos invalidos",
  "details": [
    {
      "code": "too_small",
      "minimum": 0,
      "type": "number",
      "inclusive": true,
      "path": ["price_cents"],
      "message": "El valor debe ser mayor o igual a 0"
    }
  ]
}
```

### Escenario 4: producto inexistente

**Peticion**

```bash
curl -X PUT http://localhost:3000/api/products/9999 \
  -H "Authorization: Bearer TU_TOKEN_JWT" \
  -H "Content-Type: application/json" \
  -d '{"name": "Producto que no existe"}'
```

**Respuesta esperada (404 Not Found)**

```json
{
  "error": "Producto no encontrado"
}
```

---

## 2. Testing de GET /products con paginacion y orden

### Escenario 1: paginacion basica

**Peticion**

```bash
curl "http://localhost:3000/api/products?page=1&limit=5"
```

**Respuesta esperada (200 OK)**

```json
{
  "data": [
    {
      "id": 1,
      "name": "Mouse Logitech G203",
      "price_cents": 19990,
      "stock": 25,
      "is_active": true,
      "createdAt": "2025-10-22T20:00:00.000Z",
      "updatedAt": "2025-10-22T20:00:00.000Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 5,
    "total": 12,
    "totalPages": 3,
    "sortBy": "id",
    "order": "asc"
  }
}
```

### Escenario 2: ordenar por precio ascendente

**Peticion**

```bash
curl "http://localhost:3000/api/products?sortBy=price_cents&order=asc"
```

**Respuesta esperada (200 OK)**  
Productos ordenados del mas barato al mas caro.

### Escenario 3: ordenar por fecha de creacion descendente

**Peticion**

```bash
curl "http://localhost:3000/api/products?sortBy=createdAt&order=desc"
```

**Respuesta esperada (200 OK)**  
Productos mas recientes primero.

### Escenario 4: combinar paginacion y orden

**Peticion**

```bash
curl "http://localhost:3000/api/products?page=2&limit=10&sortBy=price_cents&order=desc"
```

**Respuesta esperada (200 OK)**  
Segunda pagina con productos ordenados del mas caro al mas barato.

---

## 3. Coherencia en las respuestas

### Estructura de datos

- Verificar que los campos devueltos por GET y PUT tengan el mismo formato que POST.
- Deben incluir: `id`, `name`, `price_cents`, `stock`, `is_active`, `createdAt`, `updatedAt`.

### Formato de errores

- Errores de validacion: objeto con `error` y `details`.
- Errores de no encontrado: objeto con `error` y mensaje `"Producto no encontrado"`.

### Codigos HTTP

| Codigo | Uso                      |
|--------|-------------------------|
| 200    | GET y PUT exitosos      |
| 201    | POST exitoso            |
| 204    | DELETE exitoso          |
| 400    | Errores de validacion   |
| 401    | Errores de autenticacion|
| 403    | Errores de permisos     |
| 404    | Recursos no encontrados |

---

## 4. Testing de permisos

### Sin autenticacion

**Peticion**

```bash
curl -X PUT http://localhost:3000/api/products/1 \
  -H "Content-Type: application/json" \
  -d '{"name": "Prueba sin autenticacion"}'
```

**Respuesta esperada (401 Unauthorized)**

```json
{
  "error": "Autorizacion requerida"
}
```

### Con usuario CUSTOMER (sin permisos suficientes)

**Peticion**

```bash
curl -X PUT http://localhost:3000/api/products/1 \
  -H "Authorization: Bearer TOKEN_DE_CUSTOMER" \
  -H "Content-Type: application/json" \
  -d '{"name": "Prueba con customer"}'
```

**Respuesta esperada (403 Forbidden)**

```json
{
  "error": "Prohibido"
}
```

### Con usuario ADMIN o SELLER (con permisos)

**Peticion**

```bash
curl -X PUT http://localhost:3000/api/products/1 \
  -H "Authorization: Bearer TOKEN_DE_ADMIN_O_SELLER" \
  -H "Content-Type: application/json" \
  -d '{"name": "Prueba con permisos correctos"}'
```

**Respuesta esperada (200 OK)**  
Producto actualizado correctamente.

